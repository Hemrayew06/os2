---
## Front matter
title: "Отчёт по лабораторной работе №8"
subtitle: "Планировщики событий"
author: "Максат Хемраев"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true
toc-depth: 2
lof: true
lot: true
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
    - spelling=modern
    - babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float}
  - \floatplacement{figure}{H}
---

# Цель работы

Получение навыков работы с планировщиками событий cron и at.

# Отчёт по выполнению работы  

## Планирование задач с помощью *cron* и *at*

### Использование службы *cron*

1. В начале работы были получены административные привилегии с помощью команды su -.  
   Затем был проверен статус демона crond, отвечающего за выполнение запланированных задач.  
   Вывод показал, что служба активна и работает корректно.  

   ![Проверка состояния службы crond](Screenshot_1.png){ #fig:001 width=80% }

2. Далее было изучено содержимое файла /etc/crontab, где хранятся системные задания, выполняемые от различных пользователей.  
   В нём указаны переменные среды, а также пример формата записи задания:
   
   *минута (0–59)  
   *час (0–23)  
   *день месяца (1–31)  
   *месяц (1–12)  
   *день недели (0–6)  
   *пользователь команда  
   
   Такой синтаксис позволяет точно определять периодичность выполнения заданий.

3. Проверка индивидуального расписания пользователя с помощью crontab -l показала, что заданий пока нет.  

4. Для добавления нового задания был открыт редактор crontab командой crontab -e.  
   В файл добавлена строка:  
   */1 * * * * logger This message is written from root cron  
   Эта запись означает, что команда logger будет выполняться каждую минуту, отправляя сообщение в системный журнал.  

   ![Добавление нового задания cron](Screenshot_2.png){ #fig:002 width=80% }

5. После сохранения изменений список заданий был проверен снова. Новое задание появилось в расписании.  

   ![Проверка добавленного задания](Screenshot_3.png){ #fig:003 width=80% }

6. Через несколько минут были просмотрены системные журналы с помощью команды grep written /var/log/messages.  
   В выводе зафиксированы строки с сообщением "This message is written from root cron", что подтверждает успешное выполнение задания по расписанию.  

7. Далее запись в crontab была изменена на следующую:  
   0 */1 * * 1-5 logger This message is written from root cron  
   Этот синтаксис задаёт выполнение команды в начале каждого часа с понедельника по пятницу.  
   - 0 — выполнение в 0-й минуте  
   - */1 — каждый час  
   - 1-5 — рабочие дни недели (понедельник–пятница)  

   ![Изменение расписания задания cron](Screenshot_4.png){ #fig:004 width=80% }

8. Для автоматизации выполнения заданий был создан сценарий eachhour в каталоге /etc/cron.hourly.  
   В нём размещена команда:  
   #!/bin/sh  
   logger This message is written at $(date)  
   Этот скрипт записывает текущее время в системный журнал при каждом запуске ежечасного расписания.

   ![Создание сценария eachhour в cron.hourly](Screenshot_5.png){ #fig:005 width=80% }

9. Скрипт был сделан исполняемым командой chmod +x eachhour.  

10. Затем в каталоге /etc/cron.d был создан отдельный файл eachhour с содержимым:  
    11 * * * * root logger This message is written from /etc/cron.d  
    Эта запись означает, что команда будет выполняться каждый час в 11-й минуте от имени пользователя root.  

    ![Создание файла eachhour в cron.d](Screenshot_6.png){ #fig:006 width=80% }

11. После сохранения файла система начала выполнять задания в соответствии с указанными интервалами, что подтверждается появлением сообщений в журнале /var/log/messages.  

---

### Планирование заданий с помощью *at*

1. Для разового выполнения задач была использована служба atd, позволяющая запускать команды в определённое время.  
   Проверка статуса показала, что служба активна и работает.  

   ![Проверка состояния службы atd](Screenshot_7.png){ #fig:007 width=80% }

2. Команда для планирования задания: at 11:33.  
   После ввода открылась интерактивная оболочка, в которую была добавлена команда logger message from at.  
   Завершение ввода осуществлено комбинацией клавиш Ctrl + D.

3. Проверка очереди заданий командой atq показала, что задание успешно добавлено.  
   После выполнения команды в указанное время в журнале /var/log/messages появилась запись:  
   message from at  
   Это подтверждает корректную работу службы at и успешное выполнение отложенного задания.  

### 1. Как настроить задание cron, чтобы оно выполнялось раз в 2 недели?
- В стандартном синтаксисе cron нет прямого параметра «раз в две недели».  
  Однако можно задать выполнение каждое воскресенье и ограничить выполнение с помощью условия в команде.  
  Например:  
  `0 0 */14 * * команда` — запуск каждые 14 дней.  
  Альтернативно можно использовать `anacron` для заданий с интервалом более недели.

---

### 2. Как настроить задание cron, чтобы оно выполнялось 1-го и 15-го числа каждого месяца в 2 часа ночи?
- Запись в crontab будет следующей:  
  `0 2 1,15 * * команда`  
  Это означает: выполнять в 2:00 (0 минут, 2 часа) 1-го и 15-го числа каждого месяца.

---

### 3. Как настроить задание cron, чтобы оно выполнялось каждые 2 минуты каждый день?
- Используется следующий формат:  
  `*/2 * * * * команда`  
  Здесь `*/2` указывает на выполнение каждые две минуты независимо от даты и времени суток.

---

### 4. Как настроить задание cron, чтобы оно выполнялось 19 сентября ежегодно?
- Следующая запись обеспечивает выполнение один раз в год:  
  `0 0 19 9 * команда`  
  Это означает запуск в полночь 19-го числа 9-го месяца (сентября).

---

### 5. Как настроить задание cron, чтобы оно выполнялось каждый четверг сентября ежегодно?
- Для этого используется комбинация дня недели и месяца:  
  `0 0 * 9 4 команда`  
  Где `4` обозначает четверг, а `9` — сентябрь.

---

### 6. Какая команда позволяет вам назначить задание cron для пользователя alice? Приведите подтверждающий пример.
- Команда для редактирования расписания другого пользователя:  
  `crontab -u alice -e`  
  Пример записи:  
  `0 8 * * * /home/alice/backup.sh` — выполнение скрипта резервного копирования от имени пользователя **alice** каждый день в 8:00.

---

### 7. Как указать, что пользователю bob никогда не разрешено назначать задания через cron? Приведите подтверждающий пример.
- Для этого используется файл **/etc/cron.deny**.  
  Достаточно добавить строку с именем пользователя:  
  `bob`  
  После этого пользователь **bob** не сможет создавать или редактировать задания cron.

---

### 8. Вам нужно убедиться, что задание выполняется каждый день, даже если сервер во время выполнения временно недоступен. Как это сделать?
- Следует использовать планировщик **anacron**, который гарантирует выполнение пропущенных заданий после включения системы.  
  Например, запись в `/etc/anacrontab`:  
  `1 5 daily_job /usr/local/bin/task.sh`  
  Здесь `1` — выполнение раз в день, `5` — задержка в минутах после запуска системы.

---

### 9. Какая команда позволяет узнать, запланированы ли какие-либо задания на выполнение планировщиком atd?
- Для просмотра очереди заданий используется команда:  
  `atq`  
  Она выводит список всех отложенных задач, запланированных службой **atd**.

---

# Заключение

В ходе работы были изучены и practically освоены средства планирования задач в Linux с использованием служб **cron** и **at**, обеспечивающих автоматизацию и гибкое управление выполнением команд по расписанию.
