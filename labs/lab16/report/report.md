---
## Front matter
title: "Отчёт по лабораторной работе №16"
subtitle: "Программный RAID"
author: "Максат Хемраев"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true
toc-depth: 2
lof: true
lot: true
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
    - spelling=modern
    - babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float}
  - \floatplacement{figure}{H}
---

# Цель работы

Освоить работу с RAID-массивами при помощи утилиты mdadm.

# Отчёт по выполнению работы  

## Создание RAID-массива уровня 1

В начале работы были получены права суперпользователя с помощью команды `su -`. Переход к root выполнен успешно.

После запуска команды `fdisk -l | grep /dev/sd` система отобразила подключённые устройства, включая диски **/dev/sdd**, **/dev/sde**, **/dev/sdf**, созданные ранее в предыдущей работе.

![Проверка списка дисков](Screenshot_1.png){ #fig:001 width=80% }

На каждом из дисков был создан один раздел с помощью утилиты `sfdisk`. Процедура прошла успешно для всех устройств.

![Создание разделов](Screenshot_2.png){ #fig:002 width=80% }

Проверка вывела тип **83 (Linux)** для всех разделов на каждом диске.

Поиск значений, относящихся к RAID, показал тип **fd — Linux raid autodetect**.

Тип всех трёх разделов был изменён на **fd**, что подтверждено утилитой:

- раздел /dev/sdd1 получил тип fd  
- раздел /dev/sdc1 получил тип fd  
- раздел /dev/sdf1 получил тип fd  

![Изменение типа](Screenshot_3.png){ #fig:003 width=80% }

Команда `sfdisk -l` подтвердила, что каждый диск содержит один раздел формата **Linux raid autodetect**.

![Состояние дисков после изменения](Screenshot_4.png){ #fig:004 width=80% }

Был создан массив RAID1 из устройств **/dev/sdc1** и **/dev/sdd1**.  
Массив успешно инициализирован, что отображено в терминале.

![Создание массива RAID1](Screenshot_5.png){ #fig:005 width=80% }

Состояние массива проверено командами `cat /proc/mdstat`, `mdadm --query /dev/md0` и `mdadm --detail /dev/md0`.  
Обе составляющие устройства работают синхронно, ошибок не обнаружено.

![Проверка состояния RAID](Screenshot_6.png){ #fig:006 width=80% }

На RAID-массиве создана файловая система ext4. Процесс завершён успешно.

![Создание ext4](Screenshot_7.png){ #fig:007 width=80% }

Создан каталог `/mnt/raid`, в который смонтирован массив **/dev/md0**.

В файл `/etc/fstab` добавлена строка для автоматического монтирования RAID при старте системы:

`/dev/md0 /mnt/raid ext4 defaults 1 2`

![fstab запись](Screenshot_8.png){ #fig:008 width=80% }

Сбой сымитирован для устройства **/dev/sdc1**, после чего диск был удалён из массива.

Вместо сбойного устройства добавлен новый раздел — **/dev/sdf1**.  
Массив обновился и продолжил работу в штатном режиме, оба устройства активны.

![RAID после замены диска](Screenshot_9.png){ #fig:009 width=80% }

Массив размонтирован, остановлен, затем с разделов удалены суперблоки mdadm:

- /dev/sdc1  
- /dev/sdd1  
- /dev/sdf1  

![Очистка суперблоков](Screenshot_10.png){ #fig:010 width=80% }

---

## RAID-массив с горячим резервом (Hot Spare)

После получения прав суперпользователя был создан массив RAID 1 на двух дисках. Массив инициализировался нормально.

![Создание RAID1 с добавлением hotspare](Screenshot_11.png){ #fig:011 width=80% }

Затем в массив был добавлен третий диск /dev/sdf1. Он автоматически получил статус hot-spare, что подтвердили команды проверки.

![Статус массива с hotspare](Screenshot_12.png){ #fig:012 width=80% }

Состояние массива:  
- два устройства работают синхронно: /dev/sdc1 и /dev/sdd1  
- один диск находится в статусе spare (/dev/sdf1)  
- ошибок не выявлено  

После этого был сымитирован сбой диска /dev/sdc1. Команда `mdadm --detail` показала, что:  
- устройство /dev/sdc1 получило статус **faulty**,  
- массив автоматически активировал hot-spare /dev/sdf1,  
- работа массива продолжилась без потери данных.

![Автоматическая пересборка массива](Screenshot_13.png){ #fig:013 width=80% }

Затем массив был удалён, размонтирован, остановлен и на всех устройствах были очищены суперблоки.

---

## Преобразование RAID 1 в RAID 5

После получения прав администратора был создан массив RAID 1 на двух дисках /dev/sdc1 и /dev/sdd1.  
К нему был добавлен третий диск, который также получил статус hot-spare.

![Создание RAID1 перед конверсией](Screenshot_14.png){ #fig:014 width=80% }

Проверка состояния массива показала, что два устройства активны, а третий находится в режиме ожидания (spare).

![Состояние массива перед преобразованием](Screenshot_15.png){ #fig:015 width=80% }

Для преобразования уровень RAID был изменён командой `mdadm --grow --level=5`.  
После изменения структуры массив перешёл в режим перестройки (reshaping).

![Начало конверсии RAID1 → RAID5](Screenshot_16.png){ #fig:016 width=80% }

После изменения количества дисков массива до трёх (`--raid-devices=3`) началась полная ресинхронизация RAID 5.  
Проверка показала активную перестройку массива и участие трёх устройств.

![Перестройка массива в RAID5](Screenshot_17.png){ #fig:017 width=80% }

В завершение массив был размонтирован, остановлен, удалён, а суперблоки на всех устройствах были очищены.  
Также была закомментирована запись для автомонтирования в `/etc/fstab`.

# Контрольные вопросы

### 1. Приведите определение RAID

RAID (Redundant Array of Independent Disks) — это технология объединения нескольких физических дисков в единый логический массив с целью повышения производительности, отказоустойчивости или одновременно обоих параметров.
Массив управляется специальным алгоритмом, который распределяет данные и/или резервную информацию по дискам согласно выбранному уровню RAID.

---

### 2. Какие типы RAID-массивов существуют на сегодняшний день?

Наиболее распространённые уровни RAID:

* **RAID 0** — чередование (striping) без отказоустойчивости
* **RAID 1** — зеркалирование (mirroring)
* **RAID 5** — распределённая чётность
* **RAID 6** — двойная чётность
* **RAID 10 (1+0)** — комбинация зеркалирования и чередования
* **RAID 50, RAID 60** — многокомпонентные вложенные уровни
* **RAID 4** — массив с выделенным диском чётности
* **RAID JBOD** — диски объединены без распределения данных

---

### 3. Охарактеризуйте RAID 0, RAID 1, RAID 5, RAID 6: алгоритм, назначение, применение

#### RAID 0 (Striping)

* **Алгоритм**: данные дробятся на блоки и записываются порциями на разные диски.
* **Отказоустойчивость**: отсутствует — выход одного диска разрушает весь массив.
* **Преимущества**: максимальная скорость чтения и записи.
* **Назначение**: производительность важнее сохранности данных.
* **Применение**:

  * временные хранилища
  * обработка больших объёмов данных (видео, графика)
  * высокопроизводительные вычисления

#### RAID 1 (Mirroring)

* **Алгоритм**: каждый блок данных дублируется на второй диск.
* **Отказоустойчивость**: высокая — массив продолжает работу при сбое одного диска.
* **Преимущества**: высокая надёжность хранения.
* **Недостаток**: стоимость хранения в 2 раза выше (коэффициент полезного объёма 50%).
* **Применение**:

  * важные данные
  * серверы БД
  * системы, где требуется 24/7 доступность

#### RAID 5 (Distributed Parity)

* **Алгоритм**: данные и паритет (контрольная информация) распределяются по всем дискам массива.
* **Отказоустойчивость**: допускает выход из строя одного диска.
* **Преимущества**:

  * хороший баланс между ёмкостью, скоростью и надёжностью
  * эффективное использование дисков
* **Недостатки**:

  * медленная запись из-за расчёта паритета
  * длительная реконструкция массива при сбое диска
* **Применение**:

  * файловые серверы
  * системы хранения среднего уровня
  * корпоративные решения с умеренной нагрузкой

#### RAID 6 (Double Parity)

* **Алгоритм**: используется две независимые схемы паритета, распределённые по всем дискам.
* **Отказоустойчивость**: допускаются сбои **двух** дисков.
* **Преимущества**:

  * максимальная надёжность среди массивов с чётностью
  * защищённость даже во время реконструкции RAID 5
* **Недостатки**:

  * ещё более медленная запись
  * требуется минимум 4 диска
* **Применение**:

  * крупные архивы
  * системы хранения с огромными массивами дисков
  * среды, где сбой нескольких дисков вероятен

# Заключение

В ходе выполнения работы были изучены принципы организации RAID-массивов и их практическая настройка в Linux.  
Были созданы массивы уровня RAID 1, RAID 1 с горячим резервом и выполнено преобразование RAID 1 в RAID 5.  
В процессе работы рассмотрены механизмы распределения данных, автоматической реконфигурации массива при сбое диска, а также методы контроля состояния и удаления массивов.
