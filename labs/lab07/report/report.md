---
## Front matter
title: "Отчёт по лабораторной работе №7"
subtitle: "Управление журналами событий в системе"
author: "Максат Хемраев"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true
toc-depth: 2
lof: true
lot: true
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
    - spelling=modern
    - babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float}
  - \floatplacement{figure}{H}
---

# Цель работы

Получить навыки работы с журналами мониторинга различных событий в системе.

# Отчёт по выполнению работы  

## Мониторинг журнала системных событий в реальном времени

1. В трёх вкладках терминала были получены полномочия администратора с помощью команды `su -`.  

2. Во второй вкладке терминала был запущен мониторинг системных сообщений в реальном времени.  
   Это позволило отслеживать любые события, которые фиксируются в файле журнала: `tail -f /var/log/messages`.  

   ![Мониторинг системных сообщений](Screenshot_1.png){ #fig:001 width=80% }

3. В третьей вкладке терминала была выполнена попытка перехода к суперпользователю с заведомо неверным паролем.  
   В результате в окне с мониторингом отобразилось сообщение об ошибке авторизации:  
   «FAILED SU (to root) mhemraev on pts/2».  

   ![Ошибка аутентификации при su](Screenshot_2.png){ #fig:002 width=80% }

4. Затем, находясь под учётной записью обычного пользователя, была выполнена команда `logger hello`.  
   Сообщение `hello` отобразилось в окне мониторинга и одновременно было записано в файл `/var/log/messages`.  

5. После этого мониторинг сообщений `/var/log/messages` был остановлен сочетанием клавиш **Ctrl + C**.  
   Далее был выполнен анализ журнала безопасности с помощью просмотра последних строк файла `/var/log/secure`:  
   `tail -n 20 /var/log/secure`.  

   На экране отобразились записи, связанные с неудачными попытками авторизации и действиями с полномочиями суперпользователя.  

   ![Проверка журнала /var/log/secure](Screenshot_3.png){ #fig:003 width=80% }

## Изменение правил rsyslog.conf

1. В первой вкладке терминала была выполнена установка веб-сервера Apache.  
   После завершения установки служба httpd была запущена и добавлена в автозагрузку.  

   ![Установка и запуск Apache](Screenshot_4.png){ #fig:004 width=80% }

2. Во второй вкладке терминала был просмотрен журнал ошибок веб-службы с помощью трассировки файла `/var/log/httpd/error_log`.  
   На экране отобразились сообщения о запуске и настройке httpd.  

   ![Просмотр журнала ошибок Apache](Screenshot_5.png){ #fig:005 width=80% }

3. В третьей вкладке терминала был открыт конфигурационный файл `/etc/httpd/conf/httpd.conf`.  
   В его конец была добавлена строка `ErrorLog syslog:local1`, что перенаправило регистрацию ошибок веб-сервера через syslog.  

   ![Редактирование httpd.conf](Screenshot_6.png){ #fig:006 width=80% }

4. В каталоге `/etc/rsyslog.d` был создан файл `httpd.conf`.  
   В нём прописано правило `local1.* -/var/log/httpd-error.log`, которое направляет все сообщения объекта **local1** в отдельный файл журнала ошибок Apache.  

   ![Создание файла httpd.conf для rsyslog](Screenshot_7.png){ #fig:007 width=80% }

5. В первой вкладке терминала были перезапущены службы **rsyslog** и **httpd** для применения новых правил.  
   После этого сообщения об ошибках веб-сервера стали записываться в файл `/var/log/httpd-error.log`.  

6. В каталоге `/etc/rsyslog.d` был также создан файл `debug.conf`.  
   В нём прописано правило `*.debug /var/log/messages-debug`, что позволяет перенаправлять все отладочные сообщения в отдельный лог.  

   ![Создание правила для отладки](Screenshot_8.png){ #fig:008 width=80% }

7. После перезапуска службы rsyslog был включён мониторинг отладочных сообщений с помощью команды `tail -f /var/log/messages-debug`.  

8. В третьей вкладке терминала была отправлена отладочная запись:  
   `logger -p daemon.debug "Daemon Debug Message"`.  
   Сообщение успешно появилось в журнале `/var/log/messages-debug`, что подтверждает корректность настроек.  

   ![Проверка отладочного сообщения](Screenshot_9.png){ #fig:009 width=80% }
   
## Использование journalctl

1. Во второй вкладке терминала был просмотрен журнал с событиями, начиная с момента последней загрузки системы.  
   Для перемещения использовались клавиши Enter (построчно) и пробел (постранично), выход осуществлялся клавишей q.  

   ![Просмотр журнала systemd](Screenshot_10.png){ #fig:010 width=80% }

2. Журнал был выведен в консоль без применения постраничного пейджера.  
   Это позволило отобразить все записи сплошным списком: `journalctl --no-pager`.  

3. Для наблюдения за событиями в реальном времени был активирован режим: `journalctl -f`.  
   Прерывание вывода выполнялось комбинацией **Ctrl + C**.  

4. Для изучения доступных параметров фильтрации журнала была введена команда `journalctl` и дважды нажата клавиша **Tab**, что показало список из 128 возможных атрибутов.  

   ![Фильтрация по параметрам](Screenshot_13.png){ #fig:011 width=80% }

5. Далее был выполнен просмотр событий только для **UID 0** (суперпользователь).  

   ![Фильтрация по UID 0](Screenshot_14.png){ #fig:012 width=80% }

6. Для отображения последних строк журнала была использована команда: `journalctl -n 20`.  

   ![Последние 20 строк журнала](Screenshot_15.png){ #fig:013 width=80% }

7. Для просмотра исключительно сообщений об ошибках был применён фильтр по приоритету: `journalctl -p err`.  

   ![Ошибки в журнале](Screenshot_16.png){ #fig:014 width=80% }

8. Для анализа сообщений за определённый период времени была использована опция `--since`.  
   Были просмотрены все события начиная со вчерашнего дня: `journalctl --since yesterday`.  

   ![Сообщения со вчерашнего дня](Screenshot_17.png){ #fig:015 width=80% }

9. Для получения сообщений с уровнем ошибки начиная со вчерашнего дня использовалась команда:  
   `journalctl --since yesterday -p err`.  

10. Для получения детальной информации о событиях был использован вывод в расширенном формате:  
    `journalctl -o verbose`.  

11. Для изучения информации о модуле sshd были просмотрены соответствующие записи:  
    `journalctl _SYSTEMD_UNIT=sshd.service`.  

    ![Просмотр событий для sshd](Screenshot_19.png){ #fig:016 width=80% }

## Постоянный журнал journald

1. В терминале были получены полномочия администратора.  

2. Для хранения записей журнала был создан каталог `/var/log/journal`.  

3. Были скорректированы права доступа к каталогу, чтобы служба **systemd-journald** могла записывать данные:  
   - назначен владелец и группа `root:systemd-journal`;  
   - установлены права доступа `2755`.  

4. Для применения изменений служба **systemd-journald** была уведомлена сигналом:  
   `killall -USR1 systemd-journald`.  
   После этого служба начала вести постоянный журнал.  

5. Для проверки работы был выполнен просмотр записей текущей загрузки с помощью команды:  
   `journalctl -b`.  
   На экране отобразились системные сообщения, начиная с последнего запуска.  

   ![Просмотр журнала текущей загрузки](Screenshot_20.png){ #fig:017 width=80% }

# Контрольные вопросы

### 1. Какой файл используется для настройки rsyslogd?
- Основной файл конфигурации: /etc/rsyslog.conf  
- Дополнительные файлы: каталог /etc/rsyslog.d/

---

### 2. В каком файле журнала rsyslogd содержатся сообщения, связанные с аутентификацией?
- Сообщения об аутентификации хранятся в /var/log/secure

---

### 3. Если вы ничего не настроите, то сколько времени потребуется для ротации файлов журналов?
- По умолчанию ротация выполняется еженедельно  
- Настройки определяются в /etc/logrotate.conf

---

### 4. Какую строку следует добавить в конфигурацию для записи всех сообщений с приоритетом info в файл /var/log/messages.info?
- В конфигурации следует прописать правило: *.info /var/log/messages.info

---

### 5. Какая команда позволяет вам видеть сообщения журнала в режиме реального времени?
- Для rsyslog используется команда tail -f /var/log/messages  
- Для journald — команда journalctl -f

---

### 6. Какая команда позволяет вам видеть все сообщения журнала, которые были написаны для PID 1 между 9:00 и 15:00?
- journalctl _PID=1 --since "09:00" --until "15:00"

---

### 7. Какая команда позволяет вам видеть сообщения journald после последней перезагрузки системы?
- journalctl -b

---

### 8. Какая процедура позволяет сделать журнал journald постоянным?
- Создать каталог /var/log/journal  
- Назначить владельца root:systemd-journal  
- Установить права доступа 2755  
- Перезапустить journald сигналом USR1  
- После этого записи журнала сохраняются постоянно


# Заключение

В ходе работы были изучены основы журналирования в Linux, рассмотрены методы настройки службы rsyslog и systemd-journald, а также способы фильтрации и просмотра системных сообщений. Получены навыки создания постоянного журнала и применения правил для разделения логов по уровням важности.  
